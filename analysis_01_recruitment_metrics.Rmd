---
title: "Recruiting metrics"
---

```{r message=FALSE}
library(dplyr)
library(readr)
```

The merged data used below was created in data_01_import.Rmd.

```{r}
merged_followup <- read_rds("/Users/bradcannell/Desktop/merged_followup.rds")
```

Left off here...

I probably want to get some idea of what the metrics, graphs, etc look like outside of Shiny. I can use this file for that purpose. I can also refer to index.Rmd from the static dashboard. 

I may also want to get a handle on some basic Shiny functionality (e.g., filtering data on date) while I'm working on this process. That will take place in app.R.

# Sidebar

* Data refresh button

* Date filter

* Outbound caller filter

# Tab: Overview

Not 100% sure what I want this to contain yet.

## Total interviews completed out of 2,500

The total interviews completed 

# Tab: Quality control

* Call without a call log

* No response

* No answered_by

* No observational data

# Tab: Outbound calls

## Total calls made

Each row in the data should represent a single call. It isn't perfect. We know that not every single call made gets put in the FM Pro call log, but most of them do.

```{r}
nrow(merged_followup)
```

```{r}
# Calculate summary statistics about calls made that will be used in the charts below
calls_per_day <- 
  merged_followup %>%
  count(call_date) %>% 
  # Fill-in missing days with zero
  complete(call_date = seq(call_date[1], Sys.Date(), by = "1 day"), fill = list(n = 0)) %>% 
  # Add cumulative calls 
  mutate(cumulative_n = cumsum(n)) %>% 
  # Add call day variable
  mutate(
    day = weekdays(call_date),
    day = forcats::fct_relevel(day, "Monday", "Tuesday", "Wednesday", "Thursday", "Friday")
  ) %>% 
  # Improve plot readability
  rename(
    Date = call_date,
    Day = day
  )
```

```{r}
calls_per_day_plot <- calls_per_day_w_scheduled %>% 
  ggplot(aes(Date, `N called`)) +
  geom_line(color = "#8a8a8a") +
  geom_point(aes(color = `N Scheduled`)) +
  scale_x_date("Date", date_label = "%b-%d", 
    # Make sure the x-axis includes the earliest date and today with other breakes
    # coming at 1 week intervals.
    breaks = seq(min(calls_per_day_w_scheduled$Date), Sys.Date(), "weeks")
  ) +
  scale_y_continuous("Number of Calls") +
  scale_color_manual(
    "F/U Scheduled", 
    values = c("#a60303", "#6AA2E7", "#03a606"),
    drop = FALSE
  ) +
  theme_bw() +
  theme(legend.title = element_text(size = 8))

plotly::ggplotly(calls_per_day_plot)
```


## Unique MedStar IDs

```{r}
length(unique(merged_followup$medstar_id))
```

## Average calls per id

```{r}
nrow(merged_followup) / length(unique(merged_followup$medstar_id))
```

```{r}
mean(merged_followup$n_calls_by_id, na.rm = TRUE)
```

```{r}
count(merged_followup, n_calls_by_id)
```

## Created by

Go back and fix NA in data_01_import. Do that after you figure out all the things that need to be changed. Also, change the records created by Sunil as well.

```{r}
merged_followup %>% 
  # To get rid of all of Kay's different user names
  mutate(x_created_by_cl = str_to_lower(x_created_by_cl)) %>% 
  count(x_created_by_cl)
```

## Answered by

```{r}
merged_followup %>% 
  count(answered_by)
  # For data checking
  # filter(is.na(answered_by))
```


## Responses

2020-09-16: There are still some NA responses that need to be recoded. I've saved them and will ask Grace to recode them.

```{r}
merged_followup %>% 
  mutate(final_response = if_else(is.na(response_recode), response, response_recode)) %>% 
  count(final_response) %>% 
  arrange(desc(n)) %>% 
  mutate(percent = round((n / sum(n) * 100), 1))
  # For data checking
  # filter(is.na(final_response))
```

## Answered by

```{r}
merged_followup %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  mutate(percent = round((n / sum(n) * 100), 1))
  # For data checking
  # filter(is.na(final_response))
```

## Call time

## Call day

## Record status

# Tab: MoCA

# 